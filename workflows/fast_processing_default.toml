# Fast Processing Workflow Configuration
#
# Pipeline (messages and data products):
#   DAQ Simulator [stf_gen] -> Data Agent [stf_ready] -> STFs
#   -> FastMon Agent [tf_file_registered] -> STF samples
#   -> Fast Processing Agent [slice] -> TF slices -> PanDA Workers
#
# Usage: testbed run fast_processing_default

[testbed]
namespace = "wguan2"

[workflow]
name = "fast_processing"
version = "1.0"
description = "Fast processing of TF slices by PanDA/iDDS"
includes = ["daq_state_machine.toml"]

# =============================================================================
# Agent Configuration
# =============================================================================
# Fast processing requires: data agent, fastmon agent, fast_processing agent
# DAQ simulator runs as the workflow runner (always present)

[agents.data]
enabled = true
script = "example_agents/example_data_agent.py"

[agents.processing]
enabled = false
script = "example_agents/example_processing_agent.py"

[agents.fastmon]
enabled = true
script = "example_agents/example_fastmon_agent.py"

[agents.fast_processing]
enabled = true
script = "example_agents/fast_processing_agent.py"

# =============================================================================
# Fast Processing Parameters
# =============================================================================

[fast_processing]
# Count-based STF generation
stf_count = 10                  # Generate exactly 10 STF files
physics_period_count = 1        # Single physics period

# Fast processing parameters
target_worker_count = 30        # Target number of workers for processing
stf_sampling_rate = 1.0         # Fraction of STF data sampled by FastMon (100% for testing)
slices_per_sample = 15          # Number of TF slices per STF sample
slice_processing_time = 30      # Time to process one slice (seconds)
worker_rampup_time = 300        # Time to bring workers online (seconds, 5 min)
worker_rampdown_time = 60       # Time for graceful worker shutdown (seconds)
