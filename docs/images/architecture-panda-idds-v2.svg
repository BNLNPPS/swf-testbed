<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 700" font-family="Arial, sans-serif" font-size="12">
  <!-- Background -->
  <rect width="750" height="700" fill="white"/>

  <!-- Styles -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <marker id="arrowhead-dashed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#999"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="300" y="25" text-anchor="middle" font-weight="bold" font-size="16">SWF Architecture with PanDA/iDDS Integration</text>

  <!-- === EXTERNAL: DAQ === -->
  <rect x="225" y="45" width="150" height="45" rx="5" fill="#ffecb3" stroke="#ff8f00" stroke-width="2"/>
  <text x="300" y="65" text-anchor="middle" font-weight="bold">E1/E2 Fast Monitor</text>
  <text x="300" y="80" text-anchor="middle" font-size="10" fill="#666">(DAQ)</text>

  <!-- Arrow from DAQ to DAQSim -->
  <line x1="300" y1="90" x2="300" y2="120" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- === SWF AGENTS === -->
  <rect x="30" y="125" width="540" height="170" rx="5" fill="#e8f5e9" stroke="#388e3c" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="50" y="145" font-weight="bold" fill="#388e3c">SWF Agents</text>

  <!-- DAQSim -->
  <rect x="225" y="155" width="150" height="45" rx="5" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
  <text x="300" y="178" text-anchor="middle" font-weight="bold" font-size="11">swf-daqsim-agent</text>
  <text x="300" y="192" text-anchor="middle" font-size="9" fill="#666">Workflow Runner</text>

  <!-- Arrows from DAQSim to other agents -->
  <line x1="225" y1="180" x2="170" y2="220" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="300" y1="200" x2="300" y2="220" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="375" y1="180" x2="430" y2="220" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Second row agents -->
  <!-- DataAgent -->
  <rect x="50" y="225" width="120" height="55" rx="5" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
  <text x="110" y="250" text-anchor="middle" font-weight="bold" font-size="11">swf-data-agent</text>
  <text x="110" y="268" text-anchor="middle" font-size="9" fill="#666">File Registration</text>

  <!-- FastMon -->
  <rect x="240" y="225" width="120" height="55" rx="5" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
  <text x="300" y="250" text-anchor="middle" font-weight="bold" font-size="11">swf-fastmon-agent</text>
  <text x="300" y="268" text-anchor="middle" font-size="9" fill="#666">TF Sampling</text>

  <!-- FastProc -->
  <rect x="430" y="225" width="130" height="55" rx="5" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
  <text x="495" y="250" text-anchor="middle" font-weight="bold" font-size="11">swf-fastprocessing</text>
  <text x="495" y="268" text-anchor="middle" font-size="9" fill="#666">Slice Distribution</text>

  <!-- FastMon feedback to DAQ (dashed) -->
  <path d="M 300 225 Q 300 210 350 210 Q 400 210 400 120 Q 400 70 375 70" stroke="#999" stroke-width="1.5" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowhead-dashed)"/>
  <text x="415" y="150" font-size="9" fill="#666">feedback</text>

  <!-- === EXTERNAL SERVICES === -->
  <rect x="30" y="320" width="540" height="120" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="50" y="340" font-weight="bold" fill="#1976d2">External Services</text>

  <!-- Rucio -->
  <rect x="50" y="355" width="100" height="50" rx="5" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="100" y="378" text-anchor="middle" font-weight="bold" font-size="11">Rucio</text>
  <text x="100" y="393" text-anchor="middle" font-size="9" fill="#666">Data Mgmt</text>

  <!-- iDDS -->
  <rect x="250" y="355" width="100" height="50" rx="5" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="300" y="378" text-anchor="middle" font-weight="bold" font-size="11">iDDS</text>
  <text x="300" y="393" text-anchor="middle" font-size="9" fill="#666">Workflow Mgmt</text>

  <!-- PanDA -->
  <rect x="380" y="355" width="100" height="50" rx="5" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="430" y="378" text-anchor="middle" font-weight="bold" font-size="11">PanDA</text>
  <text x="430" y="393" text-anchor="middle" font-size="9" fill="#666">Workload Mgmt</text>

  <!-- Pilot -->
  <rect x="510" y="355" width="50" height="50" rx="5" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="535" y="385" text-anchor="middle" font-weight="bold" font-size="10">Pilot</text>

  <!-- DataAgent to Rucio -->
  <line x1="110" y1="280" x2="110" y2="320" stroke="#333" stroke-width="1.5"/>
  <line x1="110" y1="320" x2="100" y2="355" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- FastProc to iDDS -->
  <line x1="495" y1="280" x2="495" y2="320" stroke="#333" stroke-width="1.5"/>
  <line x1="495" y1="320" x2="320" y2="355" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- iDDS to PanDA -->
  <line x1="350" y1="380" x2="380" y2="380" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- PanDA to Pilot -->
  <line x1="480" y1="380" x2="510" y2="380" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- TF slices to Pilot (dashed, from FastMon area) -->
  <path d="M 360 260 Q 500 260 535 355" stroke="#999" stroke-width="1.5" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowhead-dashed)"/>
  <text x="460" y="285" font-size="9" fill="#666">TF slices</text>

  <!-- === MONITOR STACK === -->
  <rect x="30" y="470" width="540" height="130" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="50" y="490" font-weight="bold" fill="#7b1fa2">Monitor Stack</text>

  <!-- swf-monitor -->
  <rect x="205" y="505" width="140" height="45" rx="5" fill="#e1bee7" stroke="#7b1fa2" stroke-width="2"/>
  <text x="275" y="528" text-anchor="middle" font-weight="bold" font-size="11">swf-monitor</text>
  <text x="275" y="542" text-anchor="middle" font-size="9" fill="#666">Django App</text>

  <!-- Dashed line from agents area to monitor -->
  <line x1="300" y1="295" x2="300" y2="440" stroke="#999" stroke-width="1.5" stroke-dasharray="5,3"/>
  <line x1="300" y1="440" x2="275" y2="505" stroke="#999" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-dashed)"/>
  <text x="315" y="420" font-size="9" fill="#666">logs, status</text>

  <!-- PostgreSQL -->
  <rect x="50" y="560" width="90" height="35" rx="5" fill="#ce93d8" stroke="#7b1fa2" stroke-width="2"/>
  <text x="95" y="582" text-anchor="middle" font-weight="bold" font-size="10">PostgreSQL</text>

  <!-- Web Dashboard -->
  <rect x="160" y="560" width="80" height="35" rx="5" fill="#ce93d8" stroke="#7b1fa2" stroke-width="2"/>
  <text x="200" y="582" text-anchor="middle" font-weight="bold" font-size="10">Web UI</text>

  <!-- REST API -->
  <rect x="260" y="560" width="80" height="35" rx="5" fill="#ce93d8" stroke="#7b1fa2" stroke-width="2"/>
  <text x="300" y="582" text-anchor="middle" font-weight="bold" font-size="10">REST API</text>

  <!-- MCP Server -->
  <rect x="360" y="560" width="90" height="35" rx="5" fill="#ce93d8" stroke="#7b1fa2" stroke-width="2"/>
  <text x="405" y="582" text-anchor="middle" font-weight="bold" font-size="10">MCP Server</text>

  <!-- Monitor to outputs -->
  <line x1="220" y1="550" x2="95" y2="560" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="250" y1="550" x2="200" y2="560" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="290" y1="550" x2="300" y2="560" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="330" y1="550" x2="405" y2="560" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- === ActiveMQ (separate, on right) === -->
  <rect x="600" y="200" width="130" height="80" rx="5" fill="#ffebee" stroke="#c62828" stroke-width="2"/>
  <text x="665" y="230" text-anchor="middle" font-weight="bold">ActiveMQ</text>
  <text x="665" y="250" text-anchor="middle" font-size="10" fill="#666">Mediates all</text>
  <text x="665" y="265" text-anchor="middle" font-size="10" fill="#666">agent communication</text>

  <!-- Dashed line connecting agents to ActiveMQ -->
  <line x1="570" y1="240" x2="600" y2="240" stroke="#c62828" stroke-width="2" stroke-dasharray="5,3"/>

  <!-- Legend -->
  <rect x="600" y="520" width="130" height="100" rx="5" fill="#fafafa" stroke="#ccc" stroke-width="1"/>
  <text x="665" y="540" text-anchor="middle" font-weight="bold" font-size="11">Legend</text>

  <line x1="615" y1="555" x2="645" y2="555" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="655" y="559" font-size="9">Data flow</text>

  <line x1="615" y1="575" x2="645" y2="575" stroke="#999" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-dashed)"/>
  <text x="655" y="579" font-size="9">Async/feedback</text>

  <rect x="615" y="590" width="12" height="10" fill="#c8e6c9" stroke="#388e3c"/>
  <text x="635" y="599" font-size="9">SWF agents</text>

  <rect x="615" y="605" width="12" height="10" fill="#bbdefb" stroke="#1976d2"/>
  <text x="635" y="614" font-size="9">External svc</text>

</svg>
